<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:700" rel="stylesheet">
<style>
body{
  background-color:white;
  font-family: 'Montserrat', sans-serif;
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
}
#text{
  font-size: 60px;
  margin-top: 70px;
  text-align: center;
}
img{
display: block;
  margin-right: auto;
  margin-left: auto;
  margin-top: 210px;
  transition: all 500ms;
}
</style>
</head>
<body>
<img id='img'>
<img id='XD'>
<div id='text'></div>
<audio id='audio' autoplay loop></audio>
<script>

// V A R I A B L E S
var timesVisited = 1+Number(localStorage.getItem("dogRolled"));
console.log(timesVisited);
var currentTitle,
    currentState,
    d=document,
    imageElement = d.getElementById('img'),
    audioElement = d.getElementById('audio'),
    textElement = d.getElementById('text');
    audioElement.volume=0.4;
localStorage.setItem("dogRolled", timesVisited);
onload=function(){
  if(localStorage.getItem('konamiSans')){
    new Konami(function(){localStorage.setItem('sansSpecial',1);});
  }else{
    new Konami(function(){location='//rick.amigocraft.net';});
  }
};
// F U N C T I O N S
function setText(string){
	textElement.innerHTML=string;
}
function getRandomNumber(n){
    return Math.floor((Math.random() * n) + 1);
}
function trueReset() {
   var r = ['dogRolled','dogTrolld','dogTold', 'devTools', 'devTold', 'sansSpecial', 'konamiSans'];
   r.forEach(localStorage.removeItem, localStorage);
}
window.trueReset = trueReset;

// S T A T E
var danceOfDog = {
    music:function(){
			switch(getRandomNumber(9)){
			    case 1:
			        audioElement.src='/resources/DOD.ogg';
			    break;
			    case 2:
			        audioElement.src="/resources/0.5.ogg";
			    break;
			    case 3:
			        audioElement.src="/resources/1.ogg";
			    break;
			    case 4:
			    case 5:
			    case 6:
					case 7:
					case 8:
					case 9:
			        audioElement.src='/resources/Dogsong.ogg';
							audioElement.playbackRate=Math.random()+0.6;
			}
		},
    image:function(){imageElement.src='/resources/SmallAdog.gif';},
	  txt:function(){setText(timesVisited);},
		plugin:function(){},
};


// S A N S
// F I N I S H E D
var sans = {
	music:function(){
		if(!localStorage.getItem('sansSpecial')){
			audioElement.src='/resources/sans.ogg';
		}else{
			audioElement.src=(getRandomNumber(7)<3?'/resources/megalovania.ogg':'/resources/SongThatMightPlayWhenYouFightSans.ogg');
      setTimeout(function(){var xd = d.getElementById('XD'); xd.src='/resources/Sans.png'; xd.marginTop='100px';},15000);
		}
	},
	image:function(){
		imageElement.src='/resources/Sans.png';
	},
	txt:function(){
    if (localStorage.getItem('devTold')) {
      localStorage.setItem('konamiSans', 1);
    }
    if(timesVisited!=12){
		if(localStorage.getItem('devTools')&&!localStorage.getItem('devTold')){
      setText('Hey Kid....');
			setTimeout(function(){setText('I see you were messing with the dev tools. . .');},5000);
			setTimeout(function(){setText("Try entering: \" location='dogtrolld'; \"");},9000);
			setTimeout(function(){setText('You might find some eggs, even though it\'s not easter.');},15000);
		  setTimeout(function(){setText('Let\'s play a game. . .');},18000);
		  setTimeout(function(){setText('"Z" is [okay] "X" is [back]. Use the arrow keys to move.');},23000);
			setTimeout(function(){setText('Select normal when you are ready.');
			localStorage.setItem('devTold','true');
      window.location='https://jcw87.github.io/c2-sans-fight/';},38000);
		} else if(localStorage.getItem('dogTrolld')){
        if(!localStorage.getItem('dogTold')){
        setText('Heh.');
        setTimeout(function(){setText('I see you got ricked...');},3000);
        setTimeout(function(){setText('Welp, here\'s to another one!');window.location='dogTrolld';},6000);
      }
    }else{
      setText(timesVisited);
    }
  }else{
    setText('Okay, eleven was fine but twelve,');
    setTimeout(function(){setText('Twelve is just an excessive number.');},3000);
    setTimeout(function(){setText('Do you really think that I can kill you that many times?');},6000);
    // EKCS DEE ^--^
    setTimeout(function(){setText('Do you think that I can count that high on my fingers?');},6200);
    setTimeout(function(){location.reload();},8000);
    localStorage.removeItem('dogRolled');
    setText(timesVisited);
  }
  }
};


var Asriel = {
	music:function(){
    audioElement.src='/resources/menu6.ogg';
  },
	image:function(){
    imageElement.src='/resources/AsrielDreemur.gif';
    d.body.style.backgroundColor='black';
  },
	txt:function(){},
  };

var Default= {
  music:function(){},
  image:function(){},
  txt:function(){}
};

var Devroom = {
	music:function(){

    audioElement.playbackRate=Math.random()+0.6;
    audioElement.src='/resources/Mus_dogroom.ogg';},
	image:function(){imageElement.src='/resources/Mysterious_Door_room.png';
  d.body.style.backgroundColor='black';
  },
	txt:function(){textElement.hidden=true;
    //Yes, I know it's not text
  	localStorage.setItem('devTools','true');
  },
};


/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */


//Website Code
(function stateDeterminer(){
	switch (timesVisited) {
		case 1:
		case 2:
		case 3:
		case 4:
		case 5:
		case 6:
		case 7:
		  currentState=danceOfDog;
		break;
		case 8:
		case 9:
		case 10:
		case 11:
    case 12:
    currentState=sans;
    break;
		default:
		  currentState=Asriel;
	}
})();
function stateWriter(state){
	state.music();
  state.image();
	state.txt();
  currentState=state;
}
stateWriter(currentState);
window.currentState = currentState;
var changeTitleInterval = setInterval(function titleChanger(){
  if(currentTitle){d.title='Rekt';currentTitle=0;}else{d.title='Get';currentTitle=1;}
},500);
window.timesVisited = timesVisited;

// D E V T O O L S  L I S T E N E R
/*
var element=new Image();Object.defineProperty(element,"id",{get:function(){
  if(currentState!=Devroom){stateWriter(Devroom);}
}});console.log("%cHello",element);

*/
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
var Konami = function (callback) {
	var konami = {
		addEvent: function (obj, type, fn, ref_obj) {
			if (obj.addEventListener)
				obj.addEventListener(type, fn, false);
			else if (obj.attachEvent) {
				// IE
				obj["e" + type + fn] = fn;
				obj[type + fn] = function () {
					obj["e" + type + fn](window.event, ref_obj);
				};
				obj.attachEvent("on" + type, obj[type + fn]);
			}
		},
		input: "",
		pattern: "38384040373937396665",
		load: function (link) {
			this.addEvent(document, "keydown", function (e, ref_obj) {
				if (ref_obj) konami = ref_obj; // IE
				konami.input += e ? e.keyCode : event.keyCode;
				if (konami.input.length > konami.pattern.length)
					konami.input = konami.input.substr((konami.input.length - konami.pattern.length));
				if (konami.input == konami.pattern) {
					konami.code(link);
					konami.input = "";
					e.preventDefault();
					return false;
				}
			}, this);
			this.iphone.load(link);
		},
		code: function (link) {
			window.location = link;
		},
		iphone: {
			start_x: 0,
			start_y: 0,
			stop_x: 0,
			stop_y: 0,
			tap: false,
			capture: false,
			orig_keys: "",
			keys: ["UP", "UP", "DOWN", "DOWN", "LEFT", "RIGHT", "LEFT", "RIGHT", "TAP", "TAP"],
			code: function (link) {
				konami.code(link);
			},
			load: function (link) {
				this.orig_keys = this.keys;
				konami.addEvent(document, "touchmove", function (e) {
					if (e.touches.length == 1 && konami.iphone.capture === true) {
						var touch = e.touches[0];
						konami.iphone.stop_x = touch.pageX;
						konami.iphone.stop_y = touch.pageY;
						konami.iphone.tap = false;
						konami.iphone.capture = false;
						konami.iphone.check_direction();
					}
				});
				konami.addEvent(document, "touchend", function (evt) {
					if (konami.iphone.tap === true) konami.iphone.check_direction(link);
				}, false);
				konami.addEvent(document, "touchstart", function (evt) {
					konami.iphone.start_x = evt.changedTouches[0].pageX;
					konami.iphone.start_y = evt.changedTouches[0].pageY;
					konami.iphone.tap = true;
					konami.iphone.capture = true;
				});
			},
			check_direction: function (link) {
				x_magnitude = Math.abs(this.start_x - this.stop_x);
				y_magnitude = Math.abs(this.start_y - this.stop_y);
				x = ((this.start_x - this.stop_x) < 0) ? "RIGHT" : "LEFT";
				y = ((this.start_y - this.stop_y) < 0) ? "DOWN" : "UP";
				result = (x_magnitude > y_magnitude) ? x : y;
				result = (this.tap === true) ? "TAP" : result;

				if (result == this.keys[0]) this.keys = this.keys.slice(1, this.keys.length);
				if (this.keys.length === 0) {
					this.keys = this.orig_keys;
					this.code(link);
				}
			}
		}
	};

	typeof callback === "string" && konami.load(callback);
	if (typeof callback === "function") {
		konami.code = callback;
		konami.load();
	}

	return konami;
};
</script>
</body>
</html>
